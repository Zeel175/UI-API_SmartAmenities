<div class="bg-card flex min-w-0 flex-auto flex-col dark:bg-transparent">
  <div
    class="relative flex flex-0 flex-col border-b px-6 py-8
           sm:flex-row sm:items-center sm:justify-between md:px-8"
  >
    <div class="text-4xl font-extrabold tracking-tight">
      {{ isEditMode ? 'Edit Amenity Unit' : 'Add Amenity Unit' }}
    </div>

    <div class="mt-6 flex shrink-0 items-center sm:ml-4 sm:mt-0">
      <button
        mat-flat-button
        color="primary"
        class="app-button back-Green"
        (click)="cancel()"
      >
        View List
      </button>
    </div>
  </div>

  <div class="flex flex-auto overflow-visible">
    <div class="flex flex-auto flex-col overflow-visible sm:mb-18 sm:overflow-y-auto">
      <mat-card class="property-add-edit-form mt-4 mx-6 md:mx-8">
        <mat-card-content>
          <form [formGroup]="frmAmenityUnit" (ngSubmit)="save()" novalidate class="app-form">
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 auto-rows-min">
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Amenity</mat-label>
                <mat-select formControlName="amenityId">
                  <mat-option *ngFor="let amenity of amenities" [value]="amenity.id">
                    {{ amenity.name }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="frmAmenityUnit.get('amenityId')?.invalid && frmAmenityUnit.get('amenityId')?.touched">
                  Amenity is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Unit Name</mat-label>
                <input matInput formControlName="unitName" />
                <mat-error *ngIf="frmAmenityUnit.get('unitName')?.invalid && frmAmenityUnit.get('unitName')?.touched">
                  Unit name is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Unit Code</mat-label>
                <input matInput formControlName="unitCode" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Device</mat-label>
                <mat-select formControlName="deviceId">
                  <mat-option [value]="null">None</mat-option>
                  <mat-option *ngFor="let device of devices" [value]="device.id || device.deviceId">
                    {{ device.devName || device.name || device.deviceId || device.id }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('deviceId')?.value" appearance="outline" class="w-full">
                <mat-label>Device Username</mat-label>
                <input matInput formControlName="deviceUserName" />
                <mat-error *ngIf="frmAmenityUnit.get('deviceUserName')?.invalid && frmAmenityUnit.get('deviceUserName')?.touched">
                  Device Username is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('deviceId')?.value" appearance="outline" class="w-full">
                <mat-label>Device Password</mat-label>
                <input matInput type="password" formControlName="devicePassword" #unitDevicePasswordField />
                <button mat-icon-button type="button" (click)="
                    unitDevicePasswordField.type === 'password'
                      ? (unitDevicePasswordField.type = 'text')
                      : (unitDevicePasswordField.type = 'password')
                  " matSuffix>
                  @if (unitDevicePasswordField.type === 'password') {
                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye'"></mat-icon>
                  }
                  @if (unitDevicePasswordField.type === 'text') {
                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye-slash'"></mat-icon>
                  }
                </button>
                <mat-error *ngIf="frmAmenityUnit.get('devicePassword')?.invalid && frmAmenityUnit.get('devicePassword')?.touched">
                  Device Password is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Status</mat-label>
                <mat-select formControlName="status">
                  <mat-option *ngFor="let s of statuses" [value]="s">{{ s }}</mat-option>
                </mat-select>
                <mat-error *ngIf="frmAmenityUnit.get('status')?.invalid && frmAmenityUnit.get('status')?.touched">
                  Status is required.
                </mat-error>
              </mat-form-field>

              <div class="quill-field md:col-span-2 lg:col-span-3">
                <label class="quill-label">Short Description</label>
                <quill-editor
                  formControlName="shortDescription"
                  [modules]="quillModules"
                  [styles]="{ height: '160px' }"
                  theme="snow"
                ></quill-editor>
              </div>

              <div class="quill-field md:col-span-2 lg:col-span-3">
                <label class="quill-label">Long Description</label>
                <quill-editor
                  formControlName="longDescription"
                  [modules]="quillModules"
                  [styles]="{ height: '260px' }"
                  theme="snow"
                ></quill-editor>
              </div>
            </div>

            <div class="mt-6 text-lg font-semibold">Features</div>
            <div class="mt-3">
              <div class="flex flex-col gap-3 md:flex-row md:items-center">
                <mat-form-field appearance="outline" class="w-full md:flex-1">
                  <mat-label>Add feature</mat-label>
                  <input matInput [(ngModel)]="featureName" name="featureName" [ngModelOptions]="{standalone: true}" />
                </mat-form-field>
                <button
                  mat-icon-button
                  color="primary"
                  type="button"
                  aria-label="Add feature"
                  (click)="addFeature()"
                >
                  <mat-icon>add</mat-icon>
                </button>
              </div>

              <mat-chip-listbox class="mt-3" *ngIf="features.length">
                <mat-chip *ngFor="let feature of features.controls; let i = index" [selectable]="false" [removable]="true" (removed)="removeFeature(i)">
                  {{ feature.get('featureName')?.value }}
                  <button matChipRemove>
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip>
              </mat-chip-listbox>
            </div>

            <div class="mt-6 text-lg font-semibold">Charges</div>
            <div class="mt-3 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 auto-rows-min">
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Is Chargeable</mat-label>
                <mat-select formControlName="isChargeable">
                  <mat-option *ngFor="let opt of yesNoOptions" [value]="opt.value">{{ opt.label }}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('isChargeable')?.value" appearance="outline" class="w-full">
                <mat-label>Charge Type</mat-label>
                <mat-select formControlName="chargeType">
                  <mat-option *ngFor="let type of chargeTypes" [value]="type">{{ type }}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('isChargeable')?.value" appearance="outline" class="w-full">
                <mat-label>Base Rate</mat-label>
                <input matInput type="number" min="0" formControlName="baseRate" />
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('isChargeable')?.value" appearance="outline" class="w-full">
                <mat-label>Security Deposit</mat-label>
                <input matInput type="number" min="0" formControlName="securityDeposit" />
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('isChargeable')?.value" appearance="outline" class="w-full">
                <mat-label>Refundable Deposit</mat-label>
                <mat-select formControlName="refundableDeposit">
                  <mat-option *ngFor="let opt of yesNoOptions" [value]="opt.value">{{ opt.label }}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('isChargeable')?.value" appearance="outline" class="w-full">
                <mat-label>Tax Applicable</mat-label>
                <mat-select formControlName="taxApplicable">
                  <mat-option *ngFor="let opt of yesNoOptions" [value]="opt.value">{{ opt.label }}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('taxApplicable')?.value" appearance="outline" class="w-full">
                <mat-label>Tax Code</mat-label>
                <input matInput type="number" min="0" formControlName="taxCodeId" />
              </mat-form-field>

              <mat-form-field *ngIf="frmAmenityUnit.get('taxApplicable')?.value" appearance="outline" class="w-full">
                <mat-label>Tax Percentage</mat-label>
                <input matInput type="number" min="0" formControlName="taxPercentage" />
              </mat-form-field>
            </div>

            <div class="mt-8 flex flex-wrap gap-3">
              <button mat-flat-button color="primary" type="submit">
                Save
              </button>
              <button mat-stroked-button type="button" (click)="cancel()">
                Cancel
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
