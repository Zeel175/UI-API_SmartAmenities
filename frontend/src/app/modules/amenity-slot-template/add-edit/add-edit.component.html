<div class="bg-card flex min-w-0 flex-auto flex-col dark:bg-transparent">
  <div
    class="relative flex flex-0 flex-col border-b px-6 py-8
           sm:flex-row sm:items-center sm:justify-between md:px-8"
  >
    <div class="text-4xl font-extrabold tracking-tight">
      {{ isEditMode ? 'Edit Amenity Slot' : 'Add Amenity Slot' }}
    </div>

    <div class="mt-6 flex shrink-0 items-center sm:ml-4 sm:mt-0">
      <button
        mat-flat-button
        color="primary"
        class="app-button back-Green"
        (click)="cancel()"
      >
        View List
      </button>
    </div>
  </div>

  <div class="flex flex-auto overflow-visible">
    <div class="flex flex-auto flex-col overflow-visible sm:mb-18 sm:overflow-y-auto">
      <mat-card class="property-add-edit-form mt-4 mx-6 md:mx-8">
        <mat-card-content>
          <form [formGroup]="frmSlotTemplate" (ngSubmit)="save()" novalidate class="app-form">
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 auto-rows-min">
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Amenity</mat-label>
                <mat-select formControlName="amenityId">
                  <mat-option *ngFor="let amenity of amenities" [value]="amenity.id">
                    {{ amenity.name }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="frmSlotTemplate.get('amenityId')?.invalid && frmSlotTemplate.get('amenityId')?.touched">
                  Amenity is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field *ngIf="amenityUnits.length" appearance="outline" class="w-full">
                <mat-label>Amenity Unit</mat-label>
                <mat-select formControlName="amenityUnitId">
                  <mat-option *ngFor="let unit of amenityUnits" [value]="unit.id">
                    {{ unit.unitName }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Day of Week</mat-label>
                <mat-select formControlName="dayOfWeek">
                  <mat-option *ngFor="let day of daysOfWeek" [value]="day">
                    {{ day }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="frmSlotTemplate.get('dayOfWeek')?.invalid && frmSlotTemplate.get('dayOfWeek')?.touched">
                  Day of week is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Slot Duration (Minutes)</mat-label>
                <input matInput type="number" formControlName="slotDurationMinutes" />
                <mat-error *ngIf="frmSlotTemplate.get('slotDurationMinutes')?.invalid && frmSlotTemplate.get('slotDurationMinutes')?.touched">
                  Slot duration is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Buffer Time (Minutes)</mat-label>
                <input matInput type="number" formControlName="bufferTimeMinutes" />
              </mat-form-field>

              <!-- '<mat-checkbox formControlName="isActive" class="mt-2">Active</mat-checkbox>' -->
            </div>

            <div class="mt-6" formArrayName="timeSlots">
              <div
                *ngFor="let slotGroup of timeSlots.controls; let i = index"
                [formGroupName]="i"
                class="grid grid-cols-1 gap-4 md:grid-cols-4 auto-rows-min mb-4"
              >
                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Start Time</mat-label>
                  <input matInput [ngxTimepicker]="startTimePicker" formControlName="startTime" readonly />
                  <ngx-material-timepicker #startTimePicker></ngx-material-timepicker>
                  <mat-error *ngIf="slotGroup.get('startTime')?.invalid && slotGroup.get('startTime')?.touched">
                    Start time is required.
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>End Time</mat-label>
                  <input matInput [ngxTimepicker]="endTimePicker" formControlName="endTime" readonly />
                  <ngx-material-timepicker #endTimePicker></ngx-material-timepicker>
                  <mat-error *ngIf="slotGroup.get('endTime')?.invalid && slotGroup.get('endTime')?.touched">
                    End time is required.
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Capacity Per Slot</mat-label>
                  <input matInput type="number" formControlName="capacityPerSlot" />
                </mat-form-field>

                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>Slot Charge</mat-label>
                  <input matInput type="number" min="0" step="0.01" formControlName="slotCharge" />
                </mat-form-field>

                <div class="flex items-center gap-2">
                  <button mat-stroked-button type="button" color="primary" (click)="addTimeSlot()">
                    <mat-icon>add</mat-icon>
                    Add slot
                  </button>
                  <button
                    mat-stroked-button
                    type="button"
                    color="warn"
                    (click)="removeTimeSlot(i)"
                    [disabled]="timeSlots.length === 1"
                  >
                    <mat-icon>remove</mat-icon>
                    Remove
                  </button>
                </div>
              </div>
            </div>

            <div class="flex justify-center mt-6">
              <button
                mat-flat-button
                color="primary"
                type="submit"
                class="app-button back-Green"
              >
                Save
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
